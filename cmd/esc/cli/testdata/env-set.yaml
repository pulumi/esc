run: |
  esc env init test
  esc env set test foo.bar.baz qux && esc env get test
  esc env set test foo.bar.alpha zed && esc env get test
  esc env set test 'foo.beta[0]' gamma && esc env get test
  esc env set test 'foo.beta[1]' 42 && esc env get test
  esc env set test open '{"fn::open::test": "esc"}' && esc env get test
  esc env set test 'open["fn::open::test"]' cse && esc env get test
  esc env set test array '[hello, world]' && esc env get test
  esc env set test 'array[1]' esc && esc env get test
  esc env set test 'array[2]' '{}' && esc env get test
  esc env set test 'array[2].foo' bar && esc env get test
  esc env set test 'array[2].foo' '' && esc env get test
  esc env init test2
  esc env set test 'imports[0]' test2 && esc env get test
  esc env init test3
  esc env set test 'imports[1]' test3 && esc env get test
stdout: "> esc env init test\nEnvironment created.\n> esc env set test foo.bar.baz qux\n> esc env get test\n# Value\n```json\n{\n  \"foo\": {\n    \"bar\": {\n      \"baz\": \"qux\"\n    }\n  }\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n\n```\n\n> esc env set test foo.bar.alpha zed\n> esc env get test\n# Value\n```json\n{\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    }\n  }\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n\n```\n\n> esc env set test foo.beta[0] gamma\n> esc env get test\n# Value\n```json\n{\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\"\n    ]\n  }\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n\n```\n\n> esc env set test foo.beta[1] 42\n> esc env get test\n# Value\n```json\n{\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  }\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n\n```\n\n> esc env set test open {\"fn::open::test\": \"esc\"}\n> esc env get test\n# Value\n```json\n{\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"esc\"\n\n```\n\n> esc env set test open[\"fn::open::test\"] cse\n> esc env get test\n# Value\n```json\n{\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n\n```\n\n> esc env set test array [hello, world]\n> esc env get test\n# Value\n```json\n{\n  \"array\": [\n    \"hello\",\n    \"world\"\n  ],\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n  array:\n    - hello\n    - world\n\n```\n\n> esc env set test array[1] esc\n> esc env get test\n# Value\n```json\n{\n  \"array\": [\n    \"hello\",\n    \"esc\"\n  ],\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n  array:\n    - hello\n    - esc\n\n```\n\n> esc env set test array[2] {}\n> esc env get test\n# Value\n```json\n{\n  \"array\": [\n    \"hello\",\n    \"esc\",\n    {}\n  ],\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n  array:\n    - hello\n    - esc\n    - {}\n\n```\n\n> esc env set test array[2].foo bar\n> esc env get test\n# Value\n```json\n{\n  \"array\": [\n    \"hello\",\n    \"esc\",\n    {\n      \"foo\": \"bar\"\n    }\n  ],\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n  array:\n    - hello\n    - esc\n    - {foo: bar}\n\n```\n\n> esc env set test array[2].foo \n> esc env get test\n# Value\n```json\n{\n  \"array\": [\n    \"hello\",\n    \"esc\",\n    {\n      \"foo\": \"\"\n    }\n  ],\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n  array:\n    - hello\n    - esc\n    - {foo: \"\"}\n\n```\n\n> esc env init test2\nEnvironment created.\n> esc env set test imports[0] test2\n> esc env get test\n# Value\n```json\n{\n  \"array\": [\n    \"hello\",\n    \"esc\",\n    {\n      \"foo\": \"\"\n    }\n  ],\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n  array:\n    - hello\n    - esc\n    - {foo: \"\"}\nimports:\n  - test2\n\n```\n\n> esc env init test3\nEnvironment created.\n> esc env set test imports[1] test3\n> esc env get test\n# Value\n```json\n{\n  \"array\": [\n    \"hello\",\n    \"esc\",\n    {\n      \"foo\": \"\"\n    }\n  ],\n  \"foo\": {\n    \"bar\": {\n      \"alpha\": \"zed\",\n      \"baz\": \"qux\"\n    },\n    \"beta\": [\n      \"gamma\",\n      42\n    ]\n  },\n  \"open\": \"[unknown]\"\n}\n```\n# Definition\n```yaml\nvalues:\n  foo:\n    bar:\n      baz: qux\n      alpha: zed\n    beta:\n      - gamma\n      - 42\n  open:\n    \"fn::open::test\": \"cse\"\n  array:\n    - hello\n    - esc\n    - {foo: \"\"}\nimports:\n  - test2\n  - test3\n\n```\n\n"
stderr: "> esc env init test\n> esc env set test foo.bar.baz qux\n> esc env get test\n> esc env set test foo.bar.alpha zed\n> esc env get test\n> esc env set test foo.beta[0] gamma\n> esc env get test\n> esc env set test foo.beta[1] 42\n> esc env get test\n> esc env set test open {\"fn::open::test\": \"esc\"}\n> esc env get test\n> esc env set test open[\"fn::open::test\"] cse\n> esc env get test\n> esc env set test array [hello, world]\n> esc env get test\n> esc env set test array[1] esc\n> esc env get test\n> esc env set test array[2] {}\n> esc env get test\n> esc env set test array[2].foo bar\n> esc env get test\n> esc env set test array[2].foo \n> esc env get test\n> esc env init test2\n> esc env set test imports[0] test2\n> esc env get test\n> esc env init test3\n> esc env set test imports[1] test3\n> esc env get test\n"
